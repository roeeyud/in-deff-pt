<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/app.css">
    <script
            src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="/app.js"></script>
</head>
<body id="the-body">
<div>
    <p>מטרת המטלה היא למדוד רק את העדיפותך ולא את ביצועך.</p>
    <p>כל הבחירות הבאות הן היפוטתיות, לא אמיתיות. את(ה) לא תקבל(י) את הערכות הכספיות שבינם את(ה) בוחר(ת).</p>
    <p>---</p>
</div>
<div class="step-0">
    <p>
        אנא הכנס/י 4 ספרות אחרונות של תעודת זהות.
    </p>
    <input type="number" id="userId">
    <button onclick="enterUserId();">המשך</button>
</div>
<div class="step-1">
    <p id="questionPar"></p>
    <button type="button" onclick=nowClick(); id="now"></button>
    <button type="button" onclick=laterClick(); id="later"></button>
    <br><br><br>
    <h6 id="idPar"></h6>
</div>
<div class="step-2">
    <p>תודה על השתתפותך.</p>
</div>
<script>
    var originalLater = 4000;
    var now = 0;
    var later = originalLater;
    var current = 800;
    var userId;

    function getQueryStringValue (key) {
        return decodeURIComponent(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURIComponent(key).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
    }

    function nowClick() {
        later = current;
        current = Math.round((current + now)/2);
        printQuestion();
        calcEnd(Math.abs(later - current));
    }

    function laterClick() {
        now = current;
        current = Math.round((current + later)/2);
        printQuestion();
        calcEnd(Math.abs(now - current));
    }

    function calcEnd(diff) {
        if (diff <= 1) {
            document.getElementById('the-body').className = 'show-step-2';
            $.post('/result', {id: userId, result: current});
        }
    }

    function printQuestion() {
        document.getElementById("questionPar").innerHTML =
          "האם תעדיף לקבל " + current + " ש״ח היום, או לקבל " + originalLater + " ש״ח בעוד חצי שנה ?" ;
        document.getElementById("later").innerHTML = originalLater + ' ש״ח עוד חצי שנה';
        document.getElementById("now").innerHTML = current + ' ש״ח עכשיו';
    }

    function enterUserId() {
        userId = document.getElementById( "userId").value;
        document.getElementById('the-body').className = 'show-step-1';
    }

    var id = getQueryStringValue("id");
    printQuestion();

    document.getElementById('the-body').className = 'show-step-0';
</script>

</body>
</html>